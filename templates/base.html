{% load static tailwind_tags %}

<!DOCTYPE html>

<html lang="en" class="h-full">
     <head>
          <meta charset="UTF-8" />
          <meta
               name="viewport"
               content="width=device-width, initial-scale=1.0"
          />
          <title>
               {% block title %}Django Ecommerce - Premium Shopping Experience
               {% endblock %}
          </title>
          <meta
               name="description"
               content="{% block meta_description %}Discover amazing products at unbeatable prices. Modern ecommerce experience with fast shipping and excellent customer service.{% endblock %}"
          />

          <!-- Favicon -->
          <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />

          {% load static %} {% tailwind_css %}

          <!-- Tailwind CSS Play CDN -->
          {% comment %}
          <script src="https://cdn.tailwindcss.com"></script>
          {% endcomment %} {% comment %}
          <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
          {% endcomment %}

          <!-- Font Awesome for icons -->
          <link
               rel="stylesheet"
               href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
               integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
               crossorigin="anonymous"
               referrerpolicy="no-referrer"
          />

          {% comment %} <script
               async
               crossorigin="anonymous"
               data-clerk-publishable-key="pk_test_Z3JhbmQtaW1wYWxhLTQ3LmNsZXJrLmFjY291bnRzLmRldiQ"
               src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">
          </script> {% endcomment %}

          <!-- Custom CSS -->
          <style>
               /* Button Styles - Using Tailwind utility classes directly */
               .btn {
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    padding: 0.5rem 1rem;
                    border: 1px solid transparent;
                    font-size: 0.875rem;
                    font-weight: 500;
                    border-radius: 0.375rem;
                    transition: all 0.2s;
                    text-decoration: none;
               }

               .btn:focus {
                    outline: none;
                    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
               }

               .btn-primary {
                    background-color: #2563eb;
                    color: white;
               }

               .btn-primary:hover {
                    background-color: #1d4ed8;
               }

               .btn-secondary {
                    background-color: #4b5563;
                    color: white;
               }

               .btn-secondary:hover {
                    background-color: #374151;
               }

               .btn-outline {
                    border-color: #d1d5db;
                    color: #374151;
                    background-color: white;
               }

               .btn-outline:hover {
                    background-color: #f9fafb;
               }

               .btn-outline-primary {
                    border-color: #2563eb;
                    color: #2563eb;
                    background-color: white;
               }

               .btn-outline-primary:hover {
                    background-color: #eff6ff;
               }

               /* Navigation Styles */
               .navbar-link {
                    color: #374151;
                    transition: color 0.2s;
                    display: flex;
                    align-items: center;
                    text-decoration: none;
               }

               .navbar-link:hover {
                    color: #2563eb;
               }

               /* Product Card Styles */
               .product-card {
                    background-color: white;
                    border-radius: 0.5rem;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                    transition: all 0.3s;
                    overflow: hidden;
               }

               .product-card:hover {
                    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
               }

               .product-card img {
                    width: 100%;
                    height: 16rem;
                    object-fit: cover;
                    transition: transform 0.3s;
               }

               .product-card:hover img {
                    transform: scale(1.05);
               }

               /* Badge Styles */
               .badge {
                    display: inline-flex;
                    align-items: center;
                    padding: 0.125rem 0.625rem;
                    border-radius: 9999px;
                    font-size: 0.75rem;
                    font-weight: 500;
               }

               .badge-success {
                    background-color: #dcfce7;
                    color: #166534;
               }

               .badge-danger {
                    background-color: #fef2f2;
                    color: #991b1b;
               }

               .badge-warning {
                    background-color: #fefce8;
                    color: #a16207;
               }

               /* Price Styles */
               .price-tag {
                    font-size: 1.5rem;
                    font-weight: 700;
                    color: #2563eb;
               }

               /* Rating Stars */
               .rating-stars {
                    display: flex;
                    align-items: center;
               }

               .rating-stars .star {
                    color: #fbbf24;
                    width: 1rem;
                    height: 1rem;
               }

               .rating-stars .star-empty {
                    color: #d1d5db;
                    width: 1rem;
                    height: 1rem;
               }

               /* Form Styles */
               .form-input {
                    width: 100%;
                    padding: 0.5rem 0.75rem;
                    border: 1px solid #d1d5db;
                    border-radius: 0.375rem;
                    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
               }

               .form-input:focus {
                    outline: none;
                    border-color: #2563eb;
                    box-shadow: 0 0 0 1px #2563eb;
               }

               .form-label {
                    display: block;
                    font-size: 0.875rem;
                    font-weight: 500;
                    color: #374151;
               }

               /* Alert Styles */
               .alert {
                    display: flex;
                    align-items: center;
                    padding: 1rem;
                    border-radius: 0.5rem;
                    margin-bottom: 1rem;
               }

               .alert-success {
                    background-color: #f0fdf4;
                    color: #166534;
                    border: 1px solid #bbf7d0;
               }

               .alert-error {
                    background-color: #fef2f2;
                    color: #991b1b;
                    border: 1px solid #fecaca;
               }

               .alert-warning {
                    background-color: #fefce8;
                    color: #a16207;
                    border: 1px solid #fde68a;
               }

               .alert-info {
                    background-color: #eff6ff;
                    color: #1d4ed8;
                    border: 1px solid #bfdbfe;
               }
          </style>

          <!-- Additional head content -->
          {% block extra_head %}{% endblock %}
     </head>

     <body class="h-full flex flex-col bg-gray-50">
          <!-- Navigation Header -->
          <nav class="bg-white shadow-lg sticky top-0 z-50">
               <div class="container mx-auto px-4">
                    <div class="flex justify-between items-center py-4">
                         <!-- Logo -->
                         <div class="flex items-center space-x-2">
                              <a
                                   href="{% url 'products:home' %}"
                                   class="flex items-center space-x-2 text-2xl font-bold text-primary-600"
                              >
                                   <i class="fas fa-store text-3xl"></i>
                                   <span>ShopHub</span>
                              </a>
                         </div>

                         <!-- Search Bar -->
                         <div class="hidden md:flex flex-1 max-w-lg mx-8">
                              <form
                                   action="{% url 'products:search' %}"
                                   method="get"
                                   class="w-full"
                              >
                                   <div class="relative">
                                        <input
                                             type="text"
                                             name="q"
                                             placeholder="Search products..."
                                             class="w-full px-4 py-2 pl-10 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                                             value="{{ request.GET.q|default:'' }}"
                                        />
                                        <div
                                             class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                                        >
                                             <i
                                                  class="fas fa-search text-gray-400"
                                             ></i>
                                        </div>
                                        <button
                                             type="submit"
                                             class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                        >
                                             <i
                                                  class="fas fa-arrow-right text-primary-600 hover:text-primary-700 transition-colors"
                                             ></i>
                                        </button>
                                   </div>
                              </form>
                         </div>

                         <!-- Navigation Links -->
                         <div class="hidden lg:flex items-center space-x-6">
                              <a
                                   href="{% url 'products:home' %}"
                                   class="navbar-link"
                              >
                                   <i class="fas fa-home mr-2"></i>Home
                              </a>
                              <a
                                   href="{% url 'products:categories' %}"
                                   class="navbar-link"
                              >
                                   <i class="fas fa-th-large mr-2"></i
                                   >Categories
                              </a>
                              {% if user.is_authenticated %}
                              <a
                                   href="{% url 'orders:order_history' %}"
                                   class="navbar-link"
                              >
                                   <i class="fas fa-history mr-2"></i>Orders
                              </a>
                              <a
                                   href="{% url 'accounts:profile' %}"
                                   class="navbar-link"
                              >
                                   <i class="fas fa-user mr-2"></i>Profile
                              </a>
                              {% endif %}
                         </div>

                         <!-- Cart and User Actions -->
                         <div class="flex items-center space-x-4">
                              <!-- Cart Icon -->
                              <a
                                   href="{% url 'cart:cart_detail' %}"
                                   class="relative text-gray-700 hover:text-primary-600 transition-colors"
                              >
                                   <i class="fas fa-shopping-cart text-2xl"></i>
                                   {% if cart_items_count > 0 %}
                                   <span
                                        class="absolute -top-2 -right-2 bg-primary-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold"
                                   >
                                        {{ cart_items_count }}
                                   </span>
                                   {% endif %}
                              </a>

                              <!-- User Menu -->
                              {% if user.is_authenticated %}
                              <div class="relative group">

                                   <button class="flex items-center space-x-2 text-gray-700 hover:text-primary-600 transition-colors" >
                                        <div class="w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center" >
                                             <span class="text-white font-medium text-sm"> 
                                                  {{ user.first_name|first|upper|default:user.username|first|upper}}
                                             </span>
                                        </div>
                                        <i class="fas fa-chevron-down text-xs" ></i>
                                   </button>


                                   <!-- Dropdown Menu -->
                                   <div
                                        class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10"
                                   >
                                        <a
                                             href="{% url 'accounts:profile' %}"
                                             class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                        >
                                             <i class="fas fa-user mr-2"></i>My
                                             Profile
                                        </a>
                                        <a
                                             href="{% url 'orders:order_history' %}"
                                             class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                        >
                                             <i class="fas fa-history mr-2"></i
                                             >Order History
                                        </a>
                                        <hr class="my-2" />
                                        <form action="{% url 'accounts:logout' %}" method="post">
                                             {% csrf_token %}
                                             <button class="block px-4 py-2 w-full text-left text-sm text-red-600 hover:bg-gray-100">
                                                  <i class="fas fa-sign-out-alt mr-2" ></i >Logout
                                             </button>
                                        </form>
                                   </div>
                              </div>
                              {% else %}
                              <a href="{% url 'accounts:login' %}" class="btn btn-outline text-sm" >
                                   <i class="fas fa-sign-in-alt mr-2"></i>Login
                              </a>
                              {% comment %} <button id="mybtn">
                                   Login with Clerk
                              </button> {% endcomment %}
                              <a href="{% url 'accounts:register' %}" class="btn btn-primary text-sm">
                                   <i class="fas fa-user-plus mr-2"></i>Sign Up
                              </a>
                              {% endif %}

                              <!-- Mobile Menu Toggle -->
                              <button
                                   class="lg:hidden text-gray-700 hover:text-primary-600 transition-colors"
                                   id="mobile-menu-toggle"
                              >
                                   <i class="fas fa-bars text-2xl"></i>
                              </button>
                         </div>
                    </div>

                    <!-- Mobile Menu -->
                    <div class="lg:hidden hidden" id="mobile-menu">
                         <div class="py-4 border-t border-gray-200">
                              <!-- Mobile Search -->
                              <div class="mb-4">
                                   <form
                                        action="{% url 'products:search' %}"
                                        method="get"
                                   >
                                        <div class="relative">
                                             <input
                                                  type="text"
                                                  name="q"
                                                  placeholder="Search products..."
                                                  class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
                                                  value="{{ request.GET.q|default:'' }}"
                                             />
                                             <div
                                                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                                             >
                                                  <i
                                                       class="fas fa-search text-gray-400"
                                                  ></i>
                                             </div>
                                        </div>
                                   </form>
                              </div>

                              <!-- Mobile Navigation Links -->
                              <div class="space-y-2">
                                   <a
                                        href="{% url 'products:home' %}"
                                        class="block py-2 text-gray-700 hover:text-primary-600"
                                   >
                                        <i class="fas fa-home mr-2"></i>Home
                                   </a>
                                   <a
                                        href="{% url 'products:categories' %}"
                                        class="block py-2 text-gray-700 hover:text-primary-600"
                                   >
                                        <i class="fas fa-th-large mr-2"></i
                                        >Categories
                                   </a>
                                   {% if user.is_authenticated %}
                                   <a
                                        href="{% url 'orders:order_history' %}"
                                        class="block py-2 text-gray-700 hover:text-primary-600"
                                   >
                                        <i class="fas fa-history mr-2"></i
                                        >Orders
                                   </a>
                                   <a
                                        href="{% url 'accounts:profile' %}"
                                        class="block py-2 text-gray-700 hover:text-primary-600"
                                   >
                                        <i class="fas fa-user mr-2"></i>Profile
                                   </a>
                                   {% endif %}
                              </div>
                         </div>
                    </div>
               </div>
          </nav>

          <!-- Messages -->
          {% if messages %}
          <div class="container mx-auto px-4 mt-4">
               {% for message in messages %}
               <div
                    class="alert alert-{{ message.tags }} flex items-center justify-between p-4 mb-4 rounded-lg 
                    {% if message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200
                    {% elif message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200
                    {% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-700 border border-yellow-200
                    {% else %}bg-blue-50 text-blue-700 border border-blue-200{% endif %}"
               >
                    <span class="flex items-center">
                         {% if message.tags == 'success' %}
                         <i class="fas fa-check-circle mr-2"></i>
                         {% elif message.tags == 'error' %}
                         <i class="fas fa-exclamation-circle mr-2"></i>
                         {% elif message.tags == 'warning' %}
                         <i class="fas fa-exclamation-triangle mr-2"></i>
                         {% else %}
                         <i class="fas fa-info-circle mr-2"></i>
                         {% endif %} {{ message }}
                    </span>
                    <button
                         class="text-current hover:opacity-75"
                         onclick="this.parentElement.remove()"
                    >
                         <i class="fas fa-times"></i>
                    </button>
               </div>
               {% endfor %}
          </div>
          {% endif %}

          <!-- Main Content -->
          <main class="flex-1">{% block content %}{% endblock %}</main>

          <!-- Footer -->
          <footer class="bg-gray-900 text-white">
               <div class="container mx-auto px-4 py-12">
                    <div
                         class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"
                    >
                         <!-- Company Info -->
                         <div class="space-y-4">
                              <div class="flex items-center space-x-2">
                                   <i
                                        class="fas fa-store text-2xl text-primary-400"
                                   ></i>
                                   <span class="text-xl font-bold"
                                        >ShopHub</span
                                   >
                              </div>
                              <p class="text-gray-400 text-sm">
                                   Your premier destination for quality products
                                   at unbeatable prices. Shop with confidence
                                   and enjoy our excellent customer service.
                              </p>
                              <div class="flex space-x-4">
                                   <a
                                        href="#"
                                        class="text-gray-400 hover:text-white transition-colors"
                                   >
                                        <i class="fab fa-facebook text-xl"></i>
                                   </a>
                                   <a
                                        href="#"
                                        class="text-gray-400 hover:text-white transition-colors"
                                   >
                                        <i class="fab fa-twitter text-xl"></i>
                                   </a>
                                   <a
                                        href="#"
                                        class="text-gray-400 hover:text-white transition-colors"
                                   >
                                        <i class="fab fa-instagram text-xl"></i>
                                   </a>
                                   <a
                                        href="#"
                                        class="text-gray-400 hover:text-white transition-colors"
                                   >
                                        <i class="fab fa-youtube text-xl"></i>
                                   </a>
                              </div>
                         </div>

                         <!-- Quick Links -->
                         <div>
                              <h3 class="font-semibold text-lg mb-4">
                                   Quick Links
                              </h3>
                              <ul class="space-y-2">
                                   <li>
                                        <a
                                             href="{% url 'products:home' %}"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >Home</a
                                        >
                                   </li>
                                   <li>
                                        <a
                                             href="{% url 'products:categories' %}"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >Categories</a
                                        >
                                   </li>
                                   <li>
                                        <a
                                             href="#"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >About Us</a
                                        >
                                   </li>
                                   <li>
                                        <a
                                             href="#"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >Contact</a
                                        >
                                   </li>
                              </ul>
                         </div>

                         <!-- Customer Service -->
                         <div>
                              <h3 class="font-semibold text-lg mb-4">
                                   Customer Service
                              </h3>
                              <ul class="space-y-2">
                                   <li>
                                        <a
                                             href="#"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >Help Center</a
                                        >
                                   </li>
                                   <li>
                                        <a
                                             href="#"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >Shipping Info</a
                                        >
                                   </li>
                                   <li>
                                        <a
                                             href="#"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >Returns</a
                                        >
                                   </li>
                                   <li>
                                        <a
                                             href="#"
                                             class="text-gray-400 hover:text-white transition-colors"
                                             >Size Guide</a
                                        >
                                   </li>
                              </ul>
                         </div>

                         <!-- Newsletter -->
                         <div>
                              <h3 class="font-semibold text-lg mb-4">
                                   Stay Updated
                              </h3>
                              <p class="text-gray-400 text-sm mb-4">
                                   Subscribe to get special offers, free
                                   giveaways, and exclusive deals.
                              </p>
                              <form class="flex flex-col space-y-2">
                                   <input
                                        type="email"
                                        placeholder="Enter your email"
                                        class="px-3 py-2 bg-gray-800 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-primary-500 text-white"
                                   />
                                   <button
                                        type="submit"
                                        class="btn btn-primary text-sm"
                                   >
                                        <i class="fas fa-paper-plane mr-2"></i
                                        >Subscribe
                                   </button>
                              </form>
                         </div>
                    </div>

                    <!-- Bottom Bar -->
                    <div
                         class="border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center"
                    >
                         <p class="text-gray-400 text-sm">
                              &copy; 2024 ShopHub. All rights reserved.
                         </p>
                         <div class="flex items-center space-x-6 mt-4 md:mt-0">
                              <a
                                   href="#"
                                   class="text-gray-400 hover:text-white text-sm"
                                   >Privacy Policy</a
                              >
                              <a
                                   href="#"
                                   class="text-gray-400 hover:text-white text-sm"
                                   >Terms of Service</a
                              >
                              <div class="flex items-center space-x-2">
                                   <i
                                        class="fas fa-shield-alt text-primary-400"
                                   ></i>
                                   <span class="text-sm text-gray-400"
                                        >Secure Shopping</span
                                   >
                              </div>
                         </div>
                    </div>
               </div>
          </footer>

          <!-- JavaScript -->
          {% csrf_token %}
          <script>

               // Mobile menu toggle
               document
                    .getElementById("mobile-menu-toggle")
                    .addEventListener("click", function () {
                         const mobileMenu =
                              document.getElementById("mobile-menu");
                         mobileMenu.classList.toggle("hidden");
                    });

               // Auto-hide alerts after 5 seconds
               document.addEventListener("DOMContentLoaded", function () {
                    const alerts = document.querySelectorAll(".alert");
                    alerts.forEach((alert) => {
                         setTimeout(() => {
                              alert.style.opacity = "0";
                              setTimeout(() => alert.remove(), 300);
                         }, 5000);
                    });
               });

               
               {% comment %} window.addEventListener("load", async () => {
                    // Wait for Clerk to be ready
                    await Clerk.load();

                    //if (Clerk.session) {
                    //// ✅ User is logged in → show profile & sign out
                    //document.getElementById("auth-buttons").innerHTML = `
                    //     <button onclick="Clerk.openUserProfile()">Profile</button>
                    //     <button onclick="Clerk.signOut()">Logout</button>
                    //`;
                    //} else {
                    //// ❌ No user → show sign in button
                    //document.getElementById("auth-buttons").innerHTML = `
                    //     <button onclick="Clerk.openSignIn()">Login</button>
                    //`;
                    //}

                    if (Clerk.user) {
                         // ✅ User is logged in → show profile button with avatar
                         const userButton = document.createElement("div");
                         Clerk.mountUserButton(userButton);
                         document.getElementById("profile-button").appendChild(userButton);
                    } else {
                         // ❌ Not logged in → show sign in button instead
                         const signInButton = document.createElement("button");
                         signInButton.innerText = "Login";
                         signInButton.onclick = () => Clerk.openSignIn();
                         document.getElementById("profile-button").appendChild(signInButton);
                    }

                    // Show sign-in button (Clerk widget)
                    const btn = document.getElementById("mybtn");
                    btn.addEventListener("click", function() {
                         Clerk.openSignIn();
                    });

                    // Example: once logged in, get session token
                    Clerk.addListener(async () => {
                    if (Clerk.user) {
                         const token = await Clerk.session.getToken();
                         console.log("Clerk Session Token:", token);

                         // Example: send token to your Django backend
                         fetch("http://127.0.0.1:8000/accounts/protected/", {
                              headers: { Authorization: `Bearer ${token}` }
                         })
                         .then(r => r.json())
                         .then(d => console.log("Django says:", d));
                    }
                    });
               }); {% endcomment %}
               
          </script>

          {% block extra_js %}{% endblock %}
          
     </body>
</html>
