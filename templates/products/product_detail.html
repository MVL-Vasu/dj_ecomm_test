{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - ShopHub{% endblock %}

{% block meta_description %}{{ product.description|truncatewords:20 }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="flex items-center space-x-2 text-sm text-gray-600 mb-8">
        <a href="{% url 'products:home' %}" class="hover:text-primary-600">Home</a>
        <i class="fas fa-chevron-right text-xs"></i>
        <a href="{% url 'products:categories' %}" class="hover:text-primary-600">Categories</a>
        <i class="fas fa-chevron-right text-xs"></i>
        <a href="{{ product.category.get_absolute_url }}" class="hover:text-primary-600">{{ product.category.name }}</a>
        <i class="fas fa-chevron-right text-xs"></i>
        <span class="text-gray-400">{{ product.name }}</span>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Product Images -->
        <div class="space-y-4">
            <!-- Main Image -->
            <div class="relative bg-gray-100 rounded-2xl overflow-hidden aspect-square">
                {% with primary_image=product.get_primary_image %}
                    {% if primary_image %}
                        <img id="main-image" src="{{ primary_image.url }}" alt="{{ product.name }}" class="w-full h-full object-cover cursor-zoom-in" onclick="openImageModal()">
                    {% else %}
                        <div class="w-full h-full flex items-center justify-center">
                            <i class="fas fa-image text-6xl text-gray-400"></i>
                        </div>
                    {% endif %}
                {% endwith %}

                <!-- Product badges -->
                <div class="absolute top-4 left-4 flex flex-col gap-2">
                    {% if product.is_featured %}
                        <span class="badge bg-yellow-500 text-white font-bold px-3 py-1">
                            <i class="fas fa-star mr-1"></i>Featured
                        </span>
                    {% endif %}
                    {% if product.is_on_sale %}
                        <span class="badge bg-red-500 text-white font-bold px-3 py-1">
                            -{{ product.discount_percentage }}% OFF
                        </span>
                    {% endif %}
                    {% if not product.is_in_stock %}
                        <span class="badge bg-gray-500 text-white font-bold px-3 py-1">
                            Out of Stock
                        </span>
                    {% endif %}
                </div>

                <!-- Wishlist Button -->
                <button class="absolute top-4 right-4 w-12 h-12 bg-white rounded-full shadow-lg hover:bg-red-50 hover:text-red-600 transition-colors duration-200 flex items-center justify-center">
                    <i class="far fa-heart text-xl"></i>
                </button>
            </div>

            <!-- Thumbnail Images -->
            {% with all_images=product.get_all_images %}
                {% if all_images|length > 1 %}
                    <div class="grid grid-cols-4 gap-4">
                        {% for image in all_images %}
                            <button 
                                onclick="changeMainImage('{{ image.url }}', '{{ forloop.counter0 }}')"
                                class="thumbnail-btn aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 {% if forloop.first %}border-primary-600{% else %}border-transparent{% endif %} hover:border-primary-600 transition-colors"
                                data-index="{{ forloop.counter0 }}"
                            >
                                <img src="{{ image.url }}" alt="{{ product.name }}" class="w-full h-full object-cover">
                            </button>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
        </div>

        <!-- Product Information -->
        <div class="space-y-6">
            <!-- Product Title and Category -->
            <div>
                <div class="flex items-center mb-2">
                    <a href="{{ product.category.get_absolute_url }}" class="text-primary-600 hover:text-primary-700 font-medium text-sm">
                        <i class="fas fa-tag mr-1"></i>{{ product.category.name }}
                    </a>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">{{ product.name }}</h1>
            </div>

            <!-- Rating and Reviews -->
            <div class="flex items-center space-x-4">
                <div class="flex items-center">
                    <div class="rating-stars mr-2">
                        {% for i in "12345" %}
                            <i class="fas fa-star star"></i>
                        {% endfor %}
                    </div>
                    <span class="font-semibold">4.8</span>
                </div>
                <div class="text-gray-600">
                    <a href="#reviews" class="hover:text-primary-600">({{ product.reviews.count }} review{{ product.reviews.count|pluralize }})</a>
                </div>
                <div class="text-gray-400">|</div>
                <div class="text-sm text-gray-600">
                    <i class="fas fa-barcode mr-1"></i>SKU: {{ product.sku }}
                </div>
            </div>

            <!-- Price -->
            <div class="space-y-2">
                <div class="flex items-center space-x-4">
                    <span class="text-4xl font-bold text-primary-600">${{ product.price }}</span>
                    {% if product.compare_price %}
                        <span class="text-2xl text-gray-500 line-through">${{ product.compare_price }}</span>
                        <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">
                            Save {{ product.discount_percentage }}%
                        </span>
                    {% endif %}
                </div>
                <p class="text-sm text-gray-600">
                    <i class="fas fa-info-circle mr-1"></i>
                    Free shipping on orders over $50
                </p>
            </div>

            <!-- Stock Status -->
            <div class="flex items-center space-x-2">
                {% if product.is_in_stock %}
                    <div class="flex items-center text-green-600">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span class="font-medium">In Stock</span>
                        <span class="text-gray-600 ml-2">({{ product.stock_quantity }} available)</span>
                    </div>
                {% else %}
                    <div class="flex items-center text-red-600">
                        <i class="fas fa-times-circle mr-2"></i>
                        <span class="font-medium">Out of Stock</span>
                    </div>
                {% endif %}
            </div>

            <!-- Product Description -->
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Description</h3>
                <div class="text-gray-600 leading-relaxed">
                    {{ product.description|linebreaks }}
                </div>
            </div>

            <!-- Product Specifications -->
            {% if product.weight or product.dimensions %}
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Specifications</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        {% if product.weight %}
                            <div class="flex justify-between py-2 border-b border-gray-200">
                                <span class="text-gray-600">Weight:</span>
                                <span class="font-medium">{{ product.weight }} lbs</span>
                            </div>
                        {% endif %}
                        {% if product.dimensions %}
                            <div class="flex justify-between py-2 border-b border-gray-200">
                                <span class="text-gray-600">Dimensions:</span>
                                <span class="font-medium">{{ product.dimensions }}</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            <!-- Add to Cart Section -->
            <div class="border-t border-gray-200 pt-6">
                {% if product.is_in_stock %}
                    <div class="space-y-4">
                        <!-- Quantity Selector -->
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Quantity:</label>
                            <div class="flex items-center border border-gray-300 rounded-lg">
                                <button type="button" onclick="decreaseQuantity()" class="px-3 py-2 hover:bg-gray-100">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" id="quantity" value="1" min="1" max="{{ product.stock_quantity }}" class="w-16 text-center border-0 focus:ring-0">
                                <button type="button" onclick="increaseQuantity()" class="px-3 py-2 hover:bg-gray-100">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <span class="text-sm text-gray-600">{{ product.stock_quantity }} in stock</span>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button onclick="addToCart({{ product.id }})" class="flex-1 btn btn-primary py-4 text-lg font-bold">
                                <i class="fas fa-shopping-cart mr-2"></i>Add to Cart
                            </button>
                            <button class="btn btn-outline py-4 px-6">
                                <i class="fas fa-heart mr-2"></i>Wishlist
                            </button>
                        </div>

                        <!-- Additional Actions -->
                        <div class="flex items-center justify-center space-x-6 text-sm">
                            <button class="text-gray-600 hover:text-primary-600 flex items-center">
                                <i class="fas fa-share-alt mr-1"></i>Share
                            </button>
                            <button class="text-gray-600 hover:text-primary-600 flex items-center">
                                <i class="fas fa-question-circle mr-1"></i>Ask a Question
                            </button>
                            <button class="text-gray-600 hover:text-primary-600 flex items-center">
                                <i class="fas fa-ruler mr-1"></i>Size Guide
                            </button>
                        </div>
                    </div>
                {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-ban text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Out of Stock</h3>
                        <p class="text-gray-500 mb-4">This item is currently unavailable.</p>
                        <button class="btn btn-outline">
                            <i class="fas fa-bell mr-2"></i>Notify When Available
                        </button>
                    </div>
                {% endif %}
            </div>

            <!-- Trust Badges -->
            <div class="border-t border-gray-200 pt-6">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-center">
                    <div class="flex flex-col items-center text-sm">
                        <i class="fas fa-truck text-2xl text-green-600 mb-2"></i>
                        <span class="font-medium">Free Shipping</span>
                        <span class="text-gray-600 text-xs">Orders over $50</span>
                    </div>
                    <div class="flex flex-col items-center text-sm">
                        <i class="fas fa-undo text-2xl text-blue-600 mb-2"></i>
                        <span class="font-medium">Easy Returns</span>
                        <span class="text-gray-600 text-xs">30-day policy</span>
                    </div>
                    <div class="flex flex-col items-center text-sm">
                        <i class="fas fa-shield-alt text-2xl text-purple-600 mb-2"></i>
                        <span class="font-medium">Secure Payment</span>
                        <span class="text-gray-600 text-xs">SSL protected</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Tabs -->
    <div class="mt-16">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8">
                <button onclick="showTab('description')" class="tab-button active border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="description">
                    Description
                </button>
                <button onclick="showTab('specifications')" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="specifications">
                    Specifications
                </button>
                <button onclick="showTab('reviews')" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="reviews">
                    Reviews ({{ product.reviews.count }})
                </button>
                <button onclick="showTab('shipping')" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="shipping">
                    Shipping & Returns
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div class="py-8">
            <!-- Description Tab -->
            <div id="description-tab" class="tab-content">
                <div class="prose max-w-none">
                    <h3 class="text-2xl font-bold mb-4">Product Description</h3>
                    <div class="text-gray-600 leading-relaxed">
                        {{ product.description|linebreaks }}
                    </div>
                </div>
            </div>

            <!-- Specifications Tab -->
            <div id="specifications-tab" class="tab-content hidden">
                <div class="prose max-w-none">
                    <h3 class="text-2xl font-bold mb-4">Specifications</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-3">
                            <div class="flex justify-between py-2 border-b border-gray-200">
                                <span class="text-gray-600">SKU:</span>
                                <span class="font-medium">{{ product.sku }}</span>
                            </div>
                            <div class="flex justify-between py-2 border-b border-gray-200">
                                <span class="text-gray-600">Category:</span>
                                <span class="font-medium">{{ product.category.name }}</span>
                            </div>
                            {% if product.weight %}
                            <div class="flex justify-between py-2 border-b border-gray-200">
                                <span class="text-gray-600">Weight:</span>
                                <span class="font-medium">{{ product.weight }} lbs</span>
                            </div>
                            {% endif %}
                            {% if product.dimensions %}
                            <div class="flex justify-between py-2 border-b border-gray-200">
                                <span class="text-gray-600">Dimensions:</span>
                                <span class="font-medium">{{ product.dimensions }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reviews Tab -->
            <div id="reviews-tab" class="tab-content hidden">
                <div class="space-y-8">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold">Customer Reviews</h3>
                        {% if user.is_authenticated %}
                            <button class="btn btn-primary" onclick="showReviewForm()">
                                <i class="fas fa-star mr-2"></i>Write a Review
                            </button>
                        {% endif %}
                    </div>

                    <!-- Review Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="text-center">
                            <div class="text-6xl font-bold text-primary-600 mb-2">4.8</div>
                            <div class="rating-stars mb-2 justify-center">
                                {% for i in "12345" %}
                                    <i class="fas fa-star star"></i>
                                {% endfor %}
                            </div>
                            <p class="text-gray-600">Based on {{ product.reviews.count }} review{{ product.reviews.count|pluralize }}</p>
                        </div>
                        <div class="space-y-2">
                            {% for i in "54321" %}
                            <div class="flex items-center">
                                <span class="text-sm text-gray-600 w-8">{{ i }}</span>
                                <i class="fas fa-star text-yellow-400 mr-2"></i>
                                <div class="flex-1 bg-gray-200 rounded-full h-2">
                                    <div class="bg-yellow-400 h-2 rounded-full" style="width: {% if i == '5' %}70{% elif i == '4' %}20{% else %}5{% endif %}%"></div>
                                </div>
                                <span class="text-sm text-gray-600 w-8 text-right">{% if i == '5' %}70{% elif i == '4' %}20{% else %}5{% endif %}%</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Review List -->
                    <div class="space-y-6">
                        {% for review in product.reviews.all %}
                        <div class="border border-gray-200 rounded-lg p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center space-x-4">
                                    <div class="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center">
                                        <span class="text-white font-medium">{{ review.user.first_name|first|upper|default:review.user.username|first|upper }}</span>
                                    </div>
                                    <div>
                                        <div class="font-medium">{{ review.user.first_name|default:review.user.username }}</div>
                                        <div class="text-sm text-gray-600">{{ review.created_at|date:"M d, Y" }}</div>
                                    </div>
                                </div>
                                {% if review.is_verified_purchase %}
                                    <span class="badge-success text-xs">
                                        <i class="fas fa-check mr-1"></i>Verified Purchase
                                    </span>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <div class="flex items-center mb-2">
                                    <div class="rating-stars mr-2">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= review.rating %}
                                                <i class="fas fa-star star"></i>
                                            {% else %}
                                                <i class="fas fa-star star-empty"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <span class="font-semibold">{{ review.title }}</span>
                                </div>
                            </div>
                            
                            <p class="text-gray-600 leading-relaxed">{{ review.comment }}</p>
                        </div>
                        {% empty %}
                        <div class="text-center py-12">
                            <i class="fas fa-comment-alt text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">No Reviews Yet</h3>
                            <p class="text-gray-500">Be the first to review this product!</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Shipping Tab -->
            <div id="shipping-tab" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-2xl font-bold mb-4">Shipping Information</h3>
                        <div class="space-y-4">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-truck text-green-600 mt-1"></i>
                                <div>
                                    <h4 class="font-semibold">Free Standard Shipping</h4>
                                    <p class="text-gray-600 text-sm">On orders over $50. Delivery in 3-5 business days.</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-shipping-fast text-blue-600 mt-1"></i>
                                <div>
                                    <h4 class="font-semibold">Express Shipping</h4>
                                    <p class="text-gray-600 text-sm">$9.99 for next business day delivery.</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-store text-purple-600 mt-1"></i>
                                <div>
                                    <h4 class="font-semibold">In-Store Pickup</h4>
                                    <p class="text-gray-600 text-sm">Free pickup at our retail locations.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold mb-4">Return Policy</h3>
                        <div class="space-y-4">
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-undo text-green-600 mt-1"></i>
                                <div>
                                    <h4 class="font-semibold">30-Day Returns</h4>
                                    <p class="text-gray-600 text-sm">Full refund or exchange within 30 days of purchase.</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-shield-alt text-blue-600 mt-1"></i>
                                <div>
                                    <h4 class="font-semibold">Warranty Included</h4>
                                    <p class="text-gray-600 text-sm">All products come with manufacturer warranty.</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <i class="fas fa-headset text-purple-600 mt-1"></i>
                                <div>
                                    <h4 class="font-semibold">Customer Support</h4>
                                    <p class="text-gray-600 text-sm">24/7 support for all your questions and concerns.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center hidden">
        <div class="max-w-4xl max-h-full p-4">
            <div class="relative">
                <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white hover:text-gray-300 z-10">
                    <i class="fas fa-times text-2xl"></i>
                </button>
                <img id="modalImage" src="" alt="" class="max-w-full max-h-screen rounded-lg">
                
                <!-- Modal Navigation -->
                <div class="absolute inset-y-0 left-4 flex items-center">
                    <button onclick="previousImage()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-2 rounded-full transition-all">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="absolute inset-y-0 right-4 flex items-center">
                    <button onclick="nextImage()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white p-2 rounded-full transition-all">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <!-- Image Counter -->
                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm">
                    <span id="imageCounter">1 / 1</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Gallery state
let galleryImages = [];
let currentImageIndex = 0;

// Initialize gallery on page load
document.addEventListener('DOMContentLoaded', function() {
    // Collect all gallery images
    {% with all_images=product.get_all_images %}
        {% if all_images %}
            galleryImages = [
                {% for image in all_images %}
                    '{{ image.url }}'{% if not forloop.last %},{% endif %}
                {% endfor %}
            ];
        {% endif %}
    {% endwith %}
    
    showTab('description');
    updateImageCounter();
});

// Product image gallery
function changeMainImage(imageUrl, index) {
    document.getElementById('main-image').src = imageUrl;
    currentImageIndex = parseInt(index);
    
    // Update thumbnail borders
    document.querySelectorAll('.thumbnail-btn').forEach((btn, idx) => {
        if (idx === currentImageIndex) {
            btn.classList.remove('border-transparent');
            btn.classList.add('border-primary-600');
        } else {
            btn.classList.remove('border-primary-600');
            btn.classList.add('border-transparent');
        }
    });
    
    updateImageCounter();
}

// Image modal functions
function openImageModal() {
    if (galleryImages.length === 0) return;
    
    document.getElementById('imageModal').classList.remove('hidden');
    document.getElementById('modalImage').src = galleryImages[currentImageIndex];
    document.body.style.overflow = 'hidden';
    updateImageCounter();
}

function closeImageModal() {
    document.getElementById('imageModal').classList.add('hidden');
    document.body.style.overflow = 'auto';
}

function nextImage() {
    if (galleryImages.length === 0) return;
    currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
    document.getElementById('modalImage').src = galleryImages[currentImageIndex];
    document.getElementById('main-image').src = galleryImages[currentImageIndex];
    updateThumbnailBorders();
    updateImageCounter();
}

function previousImage() {
    if (galleryImages.length === 0) return;
    currentImageIndex = currentImageIndex === 0 ? galleryImages.length - 1 : currentImageIndex - 1;
    document.getElementById('modalImage').src = galleryImages[currentImageIndex];
    document.getElementById('main-image').src = galleryImages[currentImageIndex];
    updateThumbnailBorders();
    updateImageCounter();
}

function updateThumbnailBorders() {
    document.querySelectorAll('.thumbnail-btn').forEach((btn, idx) => {
        if (idx === currentImageIndex) {
            btn.classList.remove('border-transparent');
            btn.classList.add('border-primary-600');
        } else {
            btn.classList.remove('border-primary-600');
            btn.classList.add('border-transparent');
        }
    });
}

function updateImageCounter() {
    const counter = document.getElementById('imageCounter');
    if (counter && galleryImages.length > 0) {
        counter.textContent = `${currentImageIndex + 1} / ${galleryImages.length}`;
    }
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeImageModal();
    } else if (e.key === 'ArrowLeft') {
        previousImage();
    } else if (e.key === 'ArrowRight') {
        nextImage();
    }
});

// Quantity controls
function increaseQuantity() {
    const quantityInput = document.getElementById('quantity');
    const currentValue = parseInt(quantityInput.value);
    const maxValue = parseInt(quantityInput.max);
    
    if (currentValue < maxValue) {
        quantityInput.value = currentValue + 1;
    }
}

function decreaseQuantity() {
    const quantityInput = document.getElementById('quantity');
    const currentValue = parseInt(quantityInput.value);
    
    if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
    }
}

// Add to cart functionality
function addToCart(productId) {
    const quantity = document.getElementById('quantity').value;
    
    fetch(`/cart/add/${productId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            'quantity': parseInt(quantity)
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showMessage('Product added to cart!', 'success');
            // Update cart count if element exists
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
                cartCount.textContent = data.cart_items_count;
            }
        } else {
            showMessage('Error adding product to cart', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showMessage('Error adding product to cart', 'error');
    });
}

// Tab functionality
function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active', 'border-primary-600', 'text-primary-600');
        button.classList.add('border-transparent', 'text-gray-500');
    });
    
    // Show selected tab
    document.getElementById(tabName + '-tab').classList.remove('hidden');
    
    // Add active class to clicked button
    const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
    activeButton.classList.add('active', 'border-primary-600', 'text-primary-600');
    activeButton.classList.remove('border-transparent', 'text-gray-500');
}

// Message display function
function showMessage(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} fixed top-20 right-4 z-50 flex items-center p-4 rounded-lg shadow-lg transition-all duration-300 ${
        type === 'success' ? 'bg-green-50 text-green-700 border border-green-200' : 
        'bg-red-50 text-red-700 border border-red-200'
    }`;
    
    alertDiv.innerHTML = `
        <span class="flex items-center">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} mr-2"></i>
            ${message}
        </span>
        <button class="ml-4 text-current hover:opacity-75" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        alertDiv.style.opacity = '0';
        setTimeout(() => alertDiv.remove(), 300);
    }, 3000);
}

// Review form functionality
function showReviewForm() {
    // This would open a modal or show a review form
    showMessage('Review form coming soon!', 'info');
}

// Initialize default tab
document.addEventListener('DOMContentLoaded', function() {
    showTab('description');
});
</script>
{% endblock %}
